<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">All Categories</h2>
        <a href="/admin/upload-category" class="btn btn-success">
            <i class="bi bi-plus-lg"></i> Add New
        </a>
    </div>

    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col" class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
            {{#each categories}}
            <tr id="cat-{{this._id}}">
                <td>{{this.name}}</td>
                <td class="text-end">
                    <button class="btn btn-danger btn-sm delete-category-btn" data-id="{{this._id}}">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<!-- Toast for notifications -->
<div class="position-fixed top-0 end-0 p-3" style="z-index:1080;">
    <div id="responseToast" class="toast align-items-center border-0 shadow" role="alert" aria-live="assertive"
        aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body" id="toastMessage"></div>
            <button type="button" class="btn-close m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Scripts for delete and toast -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const toastEl = document.getElementById('responseToast');
        const toastMessage = document.getElementById('toastMessage');
        let bsToast = new bootstrap.Toast(toastEl, { delay: 3000 });

        document.querySelectorAll('.delete-category-btn').forEach(btn => {
            btn.addEventListener('click', async function () {
                if (!confirm('Are you sure you want to delete this category?')) return;
                const categoryId = btn.getAttribute('data-id');
                try {
                    const response = await fetch(`/admin/delete-category/${categoryId}`, { method: 'DELETE' });
                    const data = await response.json();

                    toastEl.classList.remove('bg-success', 'bg-danger', 'text-white');
                    toastMessage.textContent = data.message;

                    if (data.status === 'success') {
                        toastEl.classList.add('bg-success', 'text-white');
                        // Remove row from table
                        document.getElementById('cat-' + categoryId)?.remove();
                    } else {
                        toastEl.classList.add('bg-danger', 'text-white');
                    }
                    bsToast.show();
                } catch (err) {
                    toastEl.classList.remove('bg-success');
                    toastEl.classList.add('bg-danger', 'text-white');
                    toastMessage.textContent = "Server error. Please try again.";
                    bsToast.show();
                }
            });
        });
    });
</script>